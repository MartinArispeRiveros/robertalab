FROM rbudde/openroberta_base:2

ARG LAST_RUN_OF_BASE=2019-04-11-15:44:00

# shallow clone of the repo. Run mvn once to install most all the artifacts needed in /root/.m2 to speed up later builds
WORKDIR /opt
ARG BRANCH=develop

RUN git clone --depth=1 -b $BRANCH https://github.com/OpenRoberta/robertalab.git
WORKDIR /opt/robertalab/OpenRobertaParent
RUN ( mvn clean install -PrunIT || echo '!!!!!!!!!! runIT crashed. Should NOT happen !!!!!!!!!!' ) && \
    cd /opt && \
    rm -rf robertalab 

# prepare the entry point
WORKDIR /opt
COPY ["./runIT.sh","./"]
RUN chmod +x ./runIT.sh
ENTRYPOINT ["/opt/runIT.sh"]